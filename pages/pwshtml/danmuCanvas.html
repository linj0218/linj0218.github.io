<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Canvas弹幕</title>
	<style type="text/css">
		#canvas{background:#000;}
		span{color:#FFFFFF;}
	</style>
</head>
<body>
<div id="body">
	<canvas id="canvas">
		<span>该浏览器不支持html5</span>
	</canvas>
	<br />
	<input type="text" name='smsg' value="" v-model="msgInput" @keyup.enter="addMsg" placeholder="请输入内容" /> <button @click="addMsg">发送</button>
</div>

<script type="text/javascript" src="../js/vue.min.js"></script>
<script type="text/javascript">
	/*var c=document.getElementById('canvas');
	var ctx=c.getContext("2d");
	var width=600;
	var height=400;
	var textList=[
		{msg:"17素材网不错我经常去，嘿嘿！", x:600, y:20},
		{msg:"今晚有没有LOL的一块啊？", x:620, y: 40},
		{msg:"这种烟真心不好抽", x:640, y: 60},
		{msg:"星期天我想去爬长城", x:660, y: 80},
		{msg:"边喝酒边看电影", x:680, y: 100},
		{msg:"如果有任何疑问可以扫码联系我哦！", x:700, y: 120}
	]
	c.width=width;
	c.height=height;

	ctx.font = "14px Courier New";

	setInterval(function(){
		ctx.clearRect(0,0,c.width,c.height);
		ctx.save();
		for(var j=0;j<textList.length;j++){
			textList[j].x-=1;
			ctx.fillStyle = "#fff"
			ctx.fillText(textList[j].msg, textList[j].x, textList[j].y);
		}
		for(var i=0;i<textList.length;i++){
			if(textList[i].x<=-ctx.measureText(textList[i].msg).width){
				textList[i].x=c.width;
			}
		}
		ctx.restore();
	},10)

	function add(){
		var msg = document.getElementById("smsg").value;
		textList.push({msg:msg, x:600, y:140});
	}*/
	var vm = new Vue({
		el: "#body",
		data: {
			width: 600,
			height: 400,
			textWidth: 20, // 弹幕间距
			textHeight: 20,
			textList: [
				{msg:"17素材网不错我经常去，嘿嘿！", x:600, y:20},
				{msg:"今晚有没有LOL的一块啊？", x:620, y: 40},
				{msg:"这种烟真心不好抽", x:640, y: 60},
				{msg:"星期天我想去爬长城", x:660, y: 80},
				{msg:"边喝酒边看电影", x:680, y: 100},
				{msg:"如果有任何疑问可以扫码联系我哦！", x:700, y: 120}
			],
			c: '',
			ctx: '',
			msgInput: ''
		},
		mounted: function(){
			this.init();
		},
		methods: {
			init: function(){
				this.c        = document.getElementById('canvas');
				this.ctx      = this.c.getContext("2d");
				this.c.width  = this.width;
				this.c.height = this.height;
				this.ctx.font = "14px Courier New";

				this.start();
			},
			start: function(){
				_this = this;
				setInterval(function(){
					_this.ctx.clearRect(0, 0, _this.c.width, _this.c.height);
					_this.ctx.save();

					for(var j=0; j<_this.textList.length; j++){
						_this.textList[j].x -= 1;
						_this.ctx.fillStyle = "#fff";
						_this.ctx.fillText(_this.textList[j].msg, _this.textList[j].x, _this.textList[j].y);
					}
					for(var i=0; i<_this.textList.length; i++){
						if(_this.textList[i].x <= -_this.ctx.measureText(_this.textList[i].msg).width){
							// _this.textList[i].x = _this.c.width;
							_this.textList.splice(i, 1);
						}
					}

					_this.ctx.restore();
				},10)
			},
			addMsg: function(){
				if(!!this.msgInput) {
					var y = this.textList[this.textList.length-1].y+this.textHeight;
					y = (y >= this.height-this.textHeight ? this.textHeight : y);

					this.textList.push({msg: this.msgInput, x: 600, y: y});
					this.msgInput = "";
				}
			}
		}
	})
	</script>
</body>
</html>